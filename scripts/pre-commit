#!/bin/sh
#
# Pre-commit hook for cardmass
#
# WHAT: Ensures version/timestamp synchronization before committing
# WHY: Enforces versioning protocol - MINOR bump before commit
#
# Installation:
#   cp scripts/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit
#
# Or use: npm run hooks:install

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "${YELLOW}[pre-commit] Running version synchronization...${NC}"

# Automatically bump MINOR version and sync all docs
node scripts/sync-version-timestamps.mjs --minor

# Check if any files were modified by the sync
if ! git diff --quiet scripts/sync-version-timestamps.mjs package.json README.md ARCHITECTURE.md ROADMAP.md TASKLIST.md LEARNINGS.md RELEASE_NOTES.md WARP.md TECH_STACK.md NAMING_GUIDE.md 2>/dev/null; then
  echo "${GREEN}[pre-commit] ✓ Version bumped to MINOR and files synced${NC}"
  echo "${YELLOW}[pre-commit] Staging updated files...${NC}"
  
  # Stage all modified documentation files
  git add package.json README.md ARCHITECTURE.md ROADMAP.md TASKLIST.md LEARNINGS.md RELEASE_NOTES.md WARP.md TECH_STACK.md NAMING_GUIDE.md 2>/dev/null
  
  echo "${GREEN}[pre-commit] ✓ Ready to commit${NC}"
else
  echo "${GREEN}[pre-commit] ✓ Version already synced${NC}"
fi

exit 0
